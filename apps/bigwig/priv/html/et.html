<html>
  <head>
    <title>So Peter... what's happening?</title>
    <link rel="stylesheet" type="text/css" href="/static/css/body.css" />
    <link rel="stylesheet" type="text/css" href="/static/css/etop_table.css" />
  </head>
  <body>
    <div id="header">
      <h1>Top</h1>
      <div id="attrib">brought to you by <a title="Fork on github" href="https://github.com/spawnfest/beamspirit">Smells Like BEAM Spirit</a></div>
    </div>

    <div id="side">
      <div id="topstats">
        <!-- etop stats -->
        <table id="node_info">
          <tr> <th>node</th>     <td id="glob_node"></td>     </tr>
          <tr> <th>clock</th>    <td id="glob_clock"></td>    </tr>
          <tr> <th>cpu</th>      <td id="glob_cpu"></td>      </tr>
          <tr> <th>tot</th>      <td id="glob_tot"></td>      </tr>
          <tr> <th>bin</th>      <td id="glob_bin"></td>      </tr>
          <tr> <th>nprocs</th>   <td id="glob_nprocs"></td>   </tr>
          <tr> <th>procs</th>    <td id="glob_procs"></td>    </tr>
          <tr> <th>code</th>     <td id="glob_code"></td>     </tr>
          <tr> <th>runqueue</th> <td id="glob_runqueue"></td> </tr>
          <tr> <th>atom</th>     <td id="glob_atom"></td>     </tr>
          <tr> <th>ets</th>      <td id="glob_ets"></td>      </tr>
        </table>
      </div>
    </div>

    <div id="main">

      <div>
        <form method="POST">
          <input type="checkbox" name="accumulate" id="accumulate">Accumulate</input>
          <input type="checkbox" name="pause" id="pause">Pause</input>
        </form>
      </div>

      <table class="display" id="etop_table">
        <thead>
          <tr>
            <th>pid</th>
            <th>name</th>
            <th>time</th>
            <th>reds</th>
            <th>mem</th>
            <th>mq</th>
            <th>mfa</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>

    <script type="text/javascript" src="/static/js/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.dataTables.extra.js"></script>
    <script type="text/javascript" src="/static/js/jquery.timers-1.2.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        var oTable = $('#etop_table').dataTable({
          "bProcessing": true,
          "iDisplayLength": 25,
          "sAjaxSource": '/top',
          // Get data piggy-backed on the main table and update the page
          "fnServerData": function(sSource, aoData, fnCallback) {
                            $.getJSON( sSource, aoData, function(json) {
                              $('#accumulate').attr('checked', json.accumulate);
                              header = json.header;
                              gs = ['node','clock','cpu','tot','bin','nprocs','procs','code','runqueue','atom','ets'];
                              for (var i = 0; i < gs.length; i++) {
                                var g = gs[i];
                                if (g in header) {
                                  $('#glob_' + g).html(header[g]);
                                }
                              }
                              fnCallback(json);
                            });
                          }
        });
        $(document).everyTime(5000, "poll_etop", function() {oTable.fnReloadAjax();});
        $('#accumulate').bind('click', function() {
          $.ajax({
            type: 'POST',
            url: '/top/config/accumulate/' + this.checked
          });
        });
        $('#pause').bind('click', function() {
          if (this.checked) {
            $(document).stopTime("poll_etop");
          } else {
            $(document).everyTime(5000, "poll_etop", function() {oTable.fnReloadAjax();});
          }
        });
       });
    </script>
  </body>
</html>
